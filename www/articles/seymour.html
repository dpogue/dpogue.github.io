<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <title itemprop="name">Seymour: Cordova build helper - dpogue.ca</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="supported-color-schemes" content="light dark">
    <meta name="color-scheme" content="light dark">
    <!--[if IE ]><script src="/js/ieshim.js"></script><![endif]-->
    <style>
body {
    color-scheme: light dark;
    margin: 0;
    padding: 0;
    font: -apple-system-body;
    font-family: system-ui, sans-serif;
    background: #2d2b36;
    background-image: linear-gradient(to bottom, #2d2b36, #2d2b36, #1a1c28);
    min-height: 100%;
    min-height: 100vh;
}

header {
    display: block;
    padding-top: env(safe-area-inset-top, 0px);
    box-sizing: border-box;
    background: #a9a6ad;
    background-image: linear-gradient(to bottom, #a9a6ad, #f7ba84);
}

header svg {
    width: 100%;
    display: block;
    overflow: hidden;
}

main {
    display: block;
    box-sizing: border-box;
    width: 90%;
    width: calc(100vw - 2rem);
    width: calc(100vw - 2rem - env(safe-area-inset-left, 0px) - env(safe-area-inset-right, 0px));
    max-width: 960px;
    margin: 0 auto;
}

h1 {
    font-size: 2em;
    font-weight: 500;
    color: #f7ba84;
}

article, section {
    display: block;
    background: #cacace;
    color: #24222a;
    padding: 1em;
    padding: 1rem;
    box-shadow: 0 0 1rem rgba(0, 0, 0, 0.25);
    border-radius: 0.25rem 0.25rem 0 0;
    border: 0.5px solid rgba(255, 255, 255, 0.5);
    line-height: 1.5;
}

a {
    color: #474658;
}
    </style>
    <style media="(prefers-color-scheme: dark)">
article, section {
    color: #cacace;
    background: #24222a;
    box-shadow: 0 0 1rem rgba(0, 0, 0, 0.25);
    border-color: rgba(0, 0, 0, 0.1);
}

a {
    color: #f7ba84;
}
    </style>
    <meta name="theme-color" content="#a9a6ad">
    <meta name="description" itemprop="description" content="A Cordova build helper designed specifically for continuous integration environments.">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="canonical" itemprop="mainEntityOfPage" href="https://dpogue.ca/articles/seymour.html">
  </head>
  <body>
    <header>
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2828 460" preserveAspectRatio="xMidYMax meet" role="presentation">
    <title>dpogue.ca</title>
    <path role="presentation" fill="#615968" d="M902 203c26-10 51-19 66-27 14-9 17-15 20-17 2-2 4 2 7 2s7-3 13-3c5-1 10 2 16 2l16-3c5 0 11 4 18 7l23 4c8 2 14 5 20 8 5 4 8 6 14 7l23 1c10 0 20 2 26 3l13 4h13c5 0 12 2 19 4l22 6 24 3 12 3h10l23 2 32 3 27 4 19 3 14 4 25 3 25 6 28 6 26 1 30 6c13 3 32 4 50 5h49c15 1 28 4 40 6l33 5 34 1 33 3c10 2 17 3 28 2h41c16 2 32 7 43 9 10 1 15-1 22-1l26 3 29 2 40 4c17 2 35 3 57 7 22 3 48 8 65 12s27 6 37 6 20-2 45 1c78 10 155 25 230 46 50 14 112 35 174 55l226 49H902"></path>
    <path role="presentation" fill="#655764" d="M1161 460l-2-184-50-26c-23-14-58-35-90-51s-61-28-79-34c-17-7-24-7-28-8-5-1-7-3-10-5l-8-11-10-13-13-10-8-3-6 3-9 9-16 14c-5 5-7 8-10 9-3 2-6 1-9 0l-10-5c-4-1-7 0-11 2l-14 8c-4 2-5 3-7 1-3-1-6-5-8-9l-6-7-6-1-8 1-10-1c-3-1-4-3-6-7-2-3-4-9-8-12s-9-3-12-4l-8-3-4 2-6-2-5 1-10-4h-9l-7 2c-2 1-4-1-6-4l-6-6c-2-1-3 1-5 1l-4 2c-2 0-5-1-8 1-3 1-6 4-9 7l-7 10c-2 3-4 5-9 7l-43 14-152 46v270"></path>
    <path role="presentation" fill="#655764" d="M778 460V214l-69-24-32-13-45-22-38-17c-7-3-7-4-7-6-1-2-1-5-5-8-3-3-10-6-16-8-7-3-13-4-19-5h-17l-10 3-7 6h-5l-6 2-8-4c-3-3-8-8-13-10-6-3-12-4-17-5h-16l-7-3-10-8c-3-1-4-2-6-1l-7 4-9 8-12 5-22 5h-9l-6 3-7 7-11 3c-3 0-5 2-7 5l-7 12-11 11-12 7c-3 2-3 1-8 2-4 0-11 0-19 2-12 3-24 7-34 14l-8 5-14 3-16-1c-5 1-11 2-16 5l-14 7-14 15c-10 11-26 31-34 76-9 45-9 102-9 171"></path>
    <path role="presentation" fill="#474658" d="M1161 460l-2-184c-33-16-65-32-91-42s-45-14-70-18c-26-4-58-7-85-9l-68-5c-18-3-29-6-39-9-9-3-17-7-29-8-30-3-60-1-89 5l-41 9c-13 2-25 1-37 0s-25-3-39-1c-13 2-28 8-44 15-39 16-78 30-119 40l1 207"></path>
    <path role="presentation" fill="#4c4859" d="M605 460V273c-21-7-42-13-59-21-17-7-30-16-43-24-14-8-27-16-44-22-31-12-63-17-96-16l-21 1-23-4c-9-1-20-3-27-2-7 0-12 2-17 4l-21 2h-27c-22 1-44 6-65 13-9 3-14 6-22 6-9 1-22-1-31-1-10 0-16 2-29 10-12 8-31 21-41 30-10 8-12 12-15 17l-12 16-12 9v169"></path>
    <path role="presentation" fill="#2d2b36" d="M0 460v-69l89-44c30-14 59-26 88-33 29-6 57-7 85-8 56-2 112-11 165-28 21-7 29-11 41-18 11-6 25-14 36-18 10-4 16-2 22-2h16c7-1 16-3 26-2l33 6c11 2 19 2 28 1s17-3 26-3c8-1 16 1 25 1l25 1c8 0 17 3 23 4 5 1 8 1 17-2l38-11c19-6 39-6 57 1l23 10c5 2 6 4 9 4h10c5 1 12 3 17 7l18 10c8 3 19 4 30 8l28 12c7 3 10 2 21 0l43-10c15-3 27-6 42-7 15-2 32-2 54 2 22 3 49 9 84 16l105 20c29 4 47 4 76 5 28 2 67 4 123 5l223 5c92 3 203 10 386 29 184 19 442 52 699 84v24"></path>
    <path role="presentation" fill="none" stroke="#2d2b36" stroke-width="6" stroke-linecap="round" d="m 2114.4321,56.96991 c -0.4226,0 -0.8451,0 2.9584,8.875197 4.015,9.086511 12.2562,27.470852 17.7505,42.685473 5.4941,15.42594 8.4525,28.10479 7.8185,38.03656 -0.6339,10.14308 -4.8602,17.53909 -12.2561,21.34274 -7.3961,3.80365 -18.1731,3.80365 -24.5125,-0.42263 -6.3394,-4.22628 -8.4526,-12.25622 -6.3394,-19.44091 2.1131,-7.18468 8.8752,-13.31279 15.2146,-16.05988 6.3394,-2.95839 12.6788,-2.32445 19.0183,-1.90183 m 7.6073,105.02317 c 0.4226,0.42263 0.6339,0.63395 1.6905,-9.08651 0.8453,-9.93177 2.5358,-29.7953 5.0716,-46.0665 a 99.740309,99.740309 0 0 1 11.4109,-36.97998 c 5.2829,-8.45257 12.6788,-13.10148 21.1314,-12.67886 8.2413,0.21131 17.5391,5.28285 21.1315,12.04491 3.5923,6.76205 1.6905,14.792 -3.8037,20.28617 a 28.10479,28.10479 0 0 1 -21.1314,6.76205 c -6.9733,-0.63394 -12.2562,-4.22629 -17.5391,-7.60731 m 134.3959,6.76205 c -6.3395,1.05658 -12.4676,2.11314 -19.0183,0 -6.762,-2.11314 -13.9468,-7.60731 -16.9051,-14.58067 -2.9585,-6.76206 -1.4793,-15.21463 4.2262,-19.86354 6.3394,-4.86023 16.9051,-5.91681 24.5125,-2.95841 7.8186,3.16972 12.6789,10.14309 14.3694,20.07485 1.6905,9.93178 0,22.82194 -2.1132,39.72708 -1.9018,17.11645 -4.2263,38.6705 -10.777,46.91176 -6.7621,8.45256 -17.7505,3.59234 -24.9351,-3.16972 a 59.16798,59.16798 0 0 1 -13.5241,-24.30113 m -19.6522,-76.70706 a 28.950047,28.950047 0 0 0 -16.4826,15.84856 c -2.5357,6.97338 0,14.792 7.1847,18.17303 7.3961,3.59234 19.8636,2.74709 25.3577,-3.38103 5.2829,-6.33943 3.5924,-17.96171 0,-24.72377 -3.8036,-6.55073 -9.5091,-8.45257 -16.0598,-5.91679 z m 84.5257,-1.69052 c 0,7.18469 -0.4227,14.36937 0.8452,21.13143 1.0566,6.97337 3.5923,13.31279 8.6638,15.84856 5.283,2.74708 13.1015,1.69051 18.5957,-1.90182 5.4942,-3.38103 8.6639,-9.50914 10.3544,-15.63726 1.4792,-6.33943 1.4792,-12.46754 1.4792,-18.80696 m 16.9052,19.65221 c 7.3959,1.05658 15.2146,2.11315 21.554,0 6.3394,-2.11313 10.9883,-7.6073 9.2978,-13.10147 -1.6905,-5.49417 -9.9318,-10.98835 -17.539,-11.19966 a 19.01828,19.01828 0 0 0 -17.9618,12.25623 c -3.1697,7.60731 -2.5357,17.75039 1.9019,23.24456 4.2263,5.49417 12.2562,6.33943 19.8635,6.33943 7.396,0 14.3694,-1.4792 21.554,-2.95841"></path>
    <a xlink:href="/">
      <rect fill="transparent" x="2050" y="50" height="200" width="400"></rect>
    </a>
  </svg>
</header>


    <main>
      <h1 id="article-title" itemprop="headline">Seymour: Cordova build helper</h1>
      <article aria-labelledby="article-title" itemprop="articleBody"><div><small>Posted on <time pubdate datetime="2015-11-16">November 16<sup>th</sup>, 2015</time></small></div>

<p>At <a href="http://ayogo.com">Ayogo Health</a>, our development process for <a href="https://cordova.apache.org/">Cordova</a> mobile apps includes a number of &quot;intermediate&quot; builds before the final version that will be released.  These range from local dev builds communicating with local dev servers, <abbr>QA</abbr> builds distributed internally communicating with a <abbr>QA</abbr> server, builds for user testing and feedback, staging builds to be shown to project clients the communicate with a staging server, ad-hoc builds for marketing and conference demonstrations, and finally the production builds that will be made available for public download.</p>
<p>Managing all of these builds can be a bit challenging, mostly around ensuring that the right build is configured to communicate with the right server, and that they have different app <abbr>ID</abbr>s and app names so they don&#39;t conflict with one another.  We use <a href="https://jenkins-ci.org/">Jenkins</a> as a continuous integration environment and also as an automated build system.  For instance, our <abbr>QA</abbr> apps are rebuilt every time there a pull request is merged and the <abbr>QA</abbr> team is notified with a changelog.</p>
<p>With Cordova, the app name and <abbr>ID</abbr> are set via a config.xml file in the root of the project.  One of the steps we have Jenkins perform is a handful of <code>sed</code> commands to manipulate those values.  Ultimately we end up with a scenario where each build job on Jenkins is running slightly different steps in slightly different orders.</p>
<h2 id="limitations">Limitations</h2>
<p>For the most part, this system works well but when there&#39;s a problem, it quickly becomes a headache to track it down.  The builds from Jenkins are in release mode so they can&#39;t be debugged directly, and trying to make debug builds locally with the same config is fraught with accidental errors.  Often the quickest solution is to <abbr>SSH</abbr> into the Jenkins machine and manually make builds there, but this is far from an idea solution.</p>
<p>After a particularly frustrating day making manual debug builds of a several instances of a project and adding Jenkins jobs for new instances, I wanted to simplify the process so that it was more reliable and easier to configure.</p>
<p>I posted a wishlist in our developer channel on Slack:</p>
<blockquote>
<p>I&#39;d like a &quot;build cordova&quot; script based on environment variables and npm run commands:</p>
<ul>
<li><code>npm run buildapp</code> should do all the grunt build steps and invoke this script</li>
<li>Debug/Release mode of the resulting app should be set via <code>AY_BUILD_MODE</code> env var</li>
<li>App <abbr>ID</abbr> should have a default in config.xml, but can be overridden by <code>AY_APP_ID</code> env var</li>
<li>App name should have a default in config.xml, but can be overridden by <code>AY_APP_NAME</code></li>
</ul>
<p>This will allow us to do matrix builds in Jenkins, generating both debug and release builds for a given commit</p>
</blockquote>
<h2 id="introducing-seymour">Introducing Seymour</h2>
<img class="img-center img-lightbg" width="481" src="/img/seymour.png" alt="">

<p><a href="https://www.npmjs.com/package/seymour">Seymour</a> was the resulting build script.  It&#39;s a thin wrapper around the Cordova build commands that will do a little bit of pre-configuration.  At the moment, it supports changing the app <abbr>ID</abbr>, name, and version number, as well as controlling which platforms to build and whether to make a debug or release build.  All of these are configured by environment variables, which means our Jenkins jobs for different builds now have the same set of steps and the only variation is the environment.</p>
<p>Effectively, Seymour will update your config.xml file values based on the environment variables, then run a <code>cordova prepare</code> which will restore all the platforms and plugins that have been installed to the project.  Finally it will run a <code>cordova build</code> command to compile the native projects.  In the future, it would ideally collect those builds and copy them into a top-level folder for easy finding.</p>
<p>Seymour is available to install through <code>npm</code>, and the code is <a href="https://github.com/dpogue/seymour">available on GitHub</a> under the Apache 2.0 licence.  Please report any issues or feature requests.</p>
<p>As a word of caution, Seymour is built on top of the recently released Cordova 5.4.0 which is known to have some issues.  Those should hopefully be fixed with a 5.4.1 release in the coming week.</p>
</article>
    </main>
  </body>
</html>
